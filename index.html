<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClubPro V12 - Stable</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #020617; color: #f8fafc; margin: 0; }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .btn-amber { background-color: #f59e0b; color: #000; font-weight: 900; }
    </style>
</head>
<body>
    <div id="app"></div>
    <script>
        const config = {
            firebase: {
                apiKey: "AIzaSyD2y4clTGDYnZmmO8Gyg0bXqsyafF-a_GI",
                authDomain: "clubpro-system.firebaseapp.com",
                projectId: "clubpro-system",
                storageBucket: "clubpro-system.firebasestorage.app",
                messagingSenderId: "825897406218",
                appId: "1:825897406218:web:a660e48a120361247934f3"
            }
        };
        firebase.initializeApp(config.firebase);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let state = { role: null, reservations: [], userPhone: '' };

        async function login(val) {
            const clean = val.trim();
            if (clean.toLowerCase() === 'res') {
                state.role = 'admin';
                localStorage.setItem('club_role', 'admin');
                render();
            } else if (clean.length >= 10) {
                const userDoc = await db.collection('users').doc(clean).get();
                if (userDoc.exists) {
                    state.role = 'promoter';
                    state.userPhone = clean;
                    localStorage.setItem('club_role', 'promoter');
                    localStorage.setItem('club_phone', clean);
                    render();
                } else {
                    const name = prompt("שם יחצן חדש:");
                    if(name) {
                        await db.collection('users').doc(clean).set({ name, phone: clean });
                        state.role = 'promoter';
                        state.userPhone = clean;
                        render();
                    }
                }
            }
        }

        function render() {
            const root = document.getElementById('app');
            if (!state.role) {
                root.innerHTML = `
                    <div class="h-screen flex items-center justify-center p-4">
                        <div class="w-full max-w-md glass p-10 rounded-[2rem] text-center">
                            <h2 class="text-3xl font-black mb-8 italic uppercase text-white">Staff Login</h2>
                            <input id="login-input" type="text" placeholder="קוד או טלפון" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 mb-4 text-center text-white text-xl outline-none">
                            <button onclick="login(document.getElementById('login-input').value)" class="w-full btn-amber py-4 rounded-xl">LOGIN</button>
                        </div>
                    </div>`;
                return;
            }
            root.innerHTML = `
                <div class="p-4">
                    <header class="flex justify-between items-center mb-6 text-white font-black italic">
                        <div>CLUB<span class="text-amber-500">PRO</span></div>
                        <button onclick="localStorage.clear(); location.reload();" class="text-xs text-slate-500 underline">יציאה</button>
                    </header>
                    <div class="space-y-4">
                        ${state.reservations.map(r => `
                            <div class="glass p-4 rounded-2xl flex justify-between items-center">
                                <div><p class="font-bold text-lg">${r.name}</p><p class="text-xs text-slate-400">${r.type} | ${r.pax} PAX</p></div>
                                <div class="text-amber-500 font-black">${r.arrived ? 'הגיע' : ''}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>`;
        }

        auth.onAuthStateChanged(user => {
            if (!user) { auth.signInAnonymously(); return; }
            db.collection('reservations').onSnapshot(snap => {
                state.reservations = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                render();
            });
            const savedRole = localStorage.getItem('club_role');
            if (savedRole) { state.role = savedRole; render(); }
            render();
        });
    </script>
</body>
</html>